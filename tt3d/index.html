<html>
<head>
    <!-- from https://github.com/aframevr/aframe/ -->
    <script>
        let vr_pos_x = 0;
        let vr_pos_y = .5;
        let vr_pos_z = .5;
        let vr_rot_x = -45;
        let vr_rot_y = 0;
        let vr_rot_z = 0;
    </script>
    <script src="js/aframe.min.js"></script>

    <script>
        AFRAME.registerComponent('objshadow', {
            init: function () {
                let el = this.el;
                el.addEventListener("model-loaded", e => {
                    let tree3D = el.getObject3D('mesh');
                    if (!tree3D) {
                        return;
                    }
                    tree3D.traverse(function (node) {
                        if (node.isMesh) {
                            node.material.emissiveIntensity = .50;
                            node.material.clipShadows = true;
                            node.material.metalness = 20;
                            console.log(node.material);
                        }
                    });
                });
            }
        });
        document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelector('a-scene').addEventListener('enter-vr', function () {
                window.setTimeout(function(){
                    document.getElementById('cameraWrapper').setAttribute('position', "0 0 1.8");
                    document.getElementById('cameraWrapper').setAttribute('rotation', "-60 0 0");
                }, 500);
            });
        });
    </script>
    <script src="js/orbit1.js"></script>
    <script src="js/keybindings.js"></script>

</head>
<body>
<a-scene renderer="     antialias: true;
                        colorManagement: true;
                        sortObjects: false;
                        physicallyCorrectLights: true;
                        alpha: true;
                        precision: low;
                        foveationLevel: 0;
" stats>
    <a-assets>
        <img id="boxTexture"
             src="https://cdn.glitch.com/0d738386-1e30-49fc-9a14-75235cb3c2a4%2Fcrate1_diffuse.png?v=1613236542455">

        <a-asset-item id="floor" src="assets/floor1.obj"></a-asset-item>
        <a-asset-item id="stool" src="assets/stool1.obj"></a-asset-item>
        <a-asset-item id="playtable" src="assets/Table1_desk.obj"></a-asset-item>
    </a-assets>

    <!--
     <a-entity id="rain" particle-system="preset: rain; color: #24CAFF; particleCount: 5000"></a-entity>
 -->

    <a-sphere  src="assets/tavern1_bg.jpg" material="side: double" open-ended="true" rotation="0 0 0" position="0 1 .5"  scale="10 6 10" roughness="1"></a-sphere>
    <a-entity light="
                       type:point;
                       shadowCameraVisible: false;
                       castShadow:true;
                       intensity:3;
                       shadowCameraTop:    10;
                       shadowCameraRight:  10;
                       shadowCameraLeft:  10;
                        decay: .5;" color="white" position="0 1 0" rotation="-90 0 0" shadow></a-entity>
    <!--
    <a-entity light="
                       type:spot;
                       shadowCameraVisible: false;
                       castShadow:true;
                       intensity:1;
                       shadowCameraTop:    10;
                       shadowCameraRight:  10;
                       shadowCameraLeft:  10;
                        decay: 2;" color="white" position="0 1 0" rotation="-90 0 0" shadow></a-entity>
-->

    <a-entity shadow="cast:true; receive:true" id="spots">

        <!--
        <a-entity light="  type:spot;
                           shadowCameraVisible: false;
                           castShadow:true;
                           intensity:1;
                           shadowCameraTop:    10;
                           shadowCameraRight:  10;
                           shadowCameraLeft:  10;
                            decay: 7;" color="yellow" position="-3 1.5 -3" rotation="-90 0 0" shadow></a-entity>

        <a-obj-model src="#lamp1" color="#ac814d" position="-3 1 3" rotation="-90 -45 0" material="roughness:0.9"
                     scale=".1 .1 .1" shadow="cast:true; receive:true"></a-obj-model>
        <a-entity light="  type:spot;
                           shadowCameraVisible: false;
                           castShadow:true;
                           intensity:1;
                           shadowCameraTop:    10;
                           shadowCameraRight:  10;
                           shadowCameraLeft:  10;
                            decay: 7;" color="yellow" position="-3 1.5 3" rotation="-90 0 0" shadow></a-entity>

        <a-obj-model src="#lamp1" color="#ac814d" position="3 1 3" rotation="-90 -45 0" material="roughness:0.9"
                     scale=".1 .1 .1" shadow="cast:true; receive:true"></a-obj-model>
        <a-entity light="  type:spot;
                           shadowCameraVisible: false;
                           castShadow:true;
                           intensity:1;
                           shadowCameraTop:    10;
                           shadowCameraRight:  10;
                           shadowCameraLeft:  10;
                            decay: 7;" color="yellow" position="3 1.5 3" rotation="-90 0 0" shadow></a-entity>

        <a-obj-model src="#lamp1" color="#ac814d" position="3 1 -3" rotation="-90 -45 0" material="roughness:0.9"
                     scale=".1 .1 .1" shadow="cast:true; receive:true"></a-obj-model>
        <a-entity light="  type:spot;
                           shadowCameraVisible: false;
                           castShadow:true;
                           intensity:1;
                           shadowCameraTop:    10;
                           shadowCameraRight:  10;
                           shadowCameraLeft:  10;
                            decay: 7;" color="yellow" position="3 1.5 -3" rotation="-90 0 0" shadow></a-entity>-->
    </a-entity>

    <!--<a-entity light="type: ambient;intensity:.3; color: #CCC"></a-entity>
    <a-entity light="type: directional;intensity:.4; color: #CCC" position="3 .4 0" shadow></a-entity>--><!--
    <a-entity light="type: ambient;intensity:.4; color: #CCC" position="0 -1 3" shadow></a-entity>
    <a-entity light="type: ambient;intensity:.4; color: #FCC" position="4 -.8 -4" shadow></a-entity>-->
    <!--<a-sky src="grodno-belarus-may-full-spherical-seamless-panorama-degrees-interior-chester-vintage-restaurant-nightclub-bar-stage-146966071.jpg" 	geometry="phi-start:50;radius:10;"></a-sky>
    -->
    <a-entity shadow="cast:true; receive:true" id="table">
        <a-box src="https://2minutetabletop.com/wp-content/uploads/2022/07/Forest-Camp-Dark-Occupied-Zoomed.jpg"
               position="0 -.01 0" rotation="0 0 0" width="1.5" height=".02" material="roughness:1"
               shadow="receive: true;"></a-box>
        <a-obj-model src="#playtable" color="#AD6B1B" position="0 -.905 0" rotation="-90 0 0" material="roughness:0.7"
                     scale=".1 .1 .1"></a-obj-model>
    </a-entity>
    <a-entity shadow="cast:true; receive:true" id="figures">
        <a-box color="#fff" depth=".01" height=".08" width=".01" position=" -.34 .04 0"></a-box>
    </a-entity>

    <a-entity shadow="cast:true; receive:true" id="interior">

        <!--<a-entity gltf-model="#kamin" position="4 -.5 -4" rotation="0 45 0"></a-entity>
        <a-obj-model src="#stool" color="#905917" position="-2 -.9 0" rotation="-90 -105 0" material="roughness:0.9"
                     scale=".1 .1 .1"></a-obj-model>
        <a-obj-model src="#stool" color="#905917" position="0 -.9 -1" rotation="-90 -170 0" material="roughness:0.9"
                     scale=".1 .1 .1"></a-obj-model>
        <a-obj-model src="#stool" color="#905917" position="2 -.9 0" rotation="-90 117 0" material="roughness:0.9"
                     scale=".1 .1 .1"></a-obj-model>
        <a-obj-model src="#stool" color="#905917" position="0 -.9 1" rotation="-90 13 0" material="roughness:0.9"
                     scale=".1 .1 .1"></a-obj-model>
        -->
    </a-entity>

    <a-entity id="cameraWrapper" height=".01" width=".01" depth=".01" position="0 0 1.8" rotation="-60 0 0">
        <a-camera></a-camera>
        <!-- <a-entity id="camera" position="0 1 .5" camera wasd-controls  look-controls></a-entity>-->
    </a-entity>
<!-- orbit-controls="
            target: #table;
            enableDamping: true;
            dampingFactor: 0.125;
            rotateSpeed:1;
            rotateToSpeed: 0.25;
            rotateTo: 0 0 0;
            logPosition: true;
            enableZoom: true;
            "-->
</a-scene>
</body>
</html>